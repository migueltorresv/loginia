define([],function(){return{init:function(e,a){const t=document.getElementById("videoInput"),o=e;Promise.all([faceapi.nets.faceRecognitionNet.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.faceLandmark68Net.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.ssdMobilenetv1.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.tinyFaceDetector.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models")]).then(function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:{}},e=>t.srcObject=e,e=>console.error(e)),console.log("video added"),async function(){const e=await Promise.all(["Churampi Rosales","Gutarra Castillo","Jimmi Bruno","Miguel Torres","Sario Chamorro"].map(async e=>{const a=[];for(let t=1;t<=3;t++){const o=await faceapi.fetchImage(`/moodle2/mod/quiz/accessrule/loginia/labeled_images/${e}/${t}.jpg`);let i=128,n=.5;const c=await faceapi.detectSingleFace(o,new faceapi.TinyFaceDetectorOptions({inputSize:i,scoreThreshold:n})).withFaceLandmarks().withFaceDescriptor();a.push(new Float32Array(c.descriptor))}return new faceapi.LabeledFaceDescriptors(e,a)}));console.log(e);const a=new faceapi.FaceMatcher(e,.7);let i="",n="";t.addEventListener("play",async()=>{console.log("Playing");const e={width:t.width,height:t.height};setInterval(async()=>{const c=await faceapi.detectAllFaces(t,new faceapi.TinyFaceDetectorOptions({inputSize:128,scoreThreshold:.5})).withFaceLandmarks().withFaceDescriptors(),s=faceapi.resizeResults(c,e),r=s.map(e=>a.findBestMatch(e.descriptor));r.forEach((e,a)=>{const t=s[a].detection.box;new faceapi.draw.DrawBox(t,{label:e.toString()}),i=e._label,n=parseInt(100*e._distance)+" %"}),document.getElementById("id_loginiamessagetext").value=o!=i?"unknown":i,document.getElementById("id_percent").value=n},100)})}()})},setup:function(e){const a=e,t=document.getElementById("mod_quiz_navblock"),o=document.createElement("div"),i=document.createElement("video");i.id="video",i.controls=!0,t.append(o),o.appendChild(i);const n=document.getElementById("video");var c="230",s=0;Promise.all([faceapi.nets.faceRecognitionNet.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.faceLandmark68Net.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.ssdMobilenetv1.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models"),faceapi.nets.tinyFaceDetector.loadFromUri("/moodle2/mod/quiz/accessrule/loginia/models")]).then(function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:{}},e=>n.srcObject=e,e=>console.error(e)),s=n.videoHeight/(n.videoWidth/c),isNaN(s)&&(s=c/(4/3)),n.setAttribute("width",c),n.setAttribute("height",s),!0,console.log("video added"),async function(){const e=await Promise.all(["Churampi Rosales","Gutarra Castillo","Jimmi Bruno","Miguel Torres","Sario Chamorro"].map(async e=>{const a=[];for(let t=1;t<=3;t++){const o=await faceapi.fetchImage(`/moodle2/mod/quiz/accessrule/loginia/labeled_images/${e}/${t}.jpg`);let i=128,n=.5;const c=await faceapi.detectSingleFace(o,new faceapi.TinyFaceDetectorOptions({inputSize:i,scoreThreshold:n})).withFaceLandmarks().withFaceDescriptor();console.log(e+t+JSON.stringify(c)),a.push(new Float32Array(c.descriptor))}return new faceapi.LabeledFaceDescriptors(e,a)}));console.log(e);const t=new faceapi.FaceMatcher(e,.7);let o="",i="",c="";n.addEventListener("play",async()=>{console.log("Playing");const e=faceapi.createCanvasFromMedia(n);let{left:s,top:r}=n.getBoundingClientRect();r+=10,e.style.left=`${s}px`,e.style.top=`${r}px`,e.style.position="absolute",document.body.appendChild(e);const l={width:n.width,height:n.height};faceapi.matchDimensions(e,l),setInterval(async()=>{const s=await faceapi.detectAllFaces(n,new faceapi.TinyFaceDetectorOptions({inputSize:128,scoreThreshold:.5})).withFaceLandmarks().withFaceDescriptors(),r=faceapi.resizeResults(s,l);e.getContext("2d").clearRect(0,0,e.width,e.height);const d=r.map(e=>t.findBestMatch(e.descriptor));d.forEach((t,n)=>{const s=r[n].detection.box;o=t._label,i=parseInt(100*t._distance)+" %",o!=a&&(o="unknown"),c=`${o} ${i}`;const l=new faceapi.draw.DrawBox(s,{label:c.toString()});l.draw(e)})},100)})}()})}}});